!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=6)}([function(e,t){e.exports='<div class="m-entitygeometry-container">\n    <div id="m-button-entitypolygon-vertical" class="m-control button">\n        \x3c!--<button id="m-addtosandbox-button" class="g-cartografia-capas" title="Añadir geometrías a la capa de trabajo"></button> --\x3e\n        <button id="m-addgeometry-button" class="icon-edition-import-button" title="{{translations.import_btn}}"></button>\n        <div id="m-selectmenu-button" class="dropdown-edition">\n            <button id="m-select-button" class="g-cartografia-flecha" title="{{translations.select_btn}}"></button>\n            <div id="myDropdown" class="dropdown-edition-content">\n                <div><button id="m-selectclick-button" class="icon-edition-select-click" title="{{translations.select_click}}"></button></div>\n                <div><button id="m-selectline-button" class="icon-edition-select-line" title="{{translations.select_line}}"></button></div>\n                <div><button id="m-selectarea-button" class="icon-edition-select-area" title="{{translations.select_area}}"></button></div>\n                <div><button id="m-selectall-button" class="icon-edition-select-all" title="{{translations.select_all}}"></button></div>\n                <div><button id="m-deselectall-button" class="icon-edition-deselect-all" title="{{translations.deselect_all}}"></button></div>\n            </div>\n        </div>\n        <div id="m-zoommenu-button" class="dropdown-edition">\n            <button id="m-zoom-button" class="g-cartografia-zoom" title="{{translations.zoom}}"></button>\n            <div id="myDropdown-edition" class="dropdown-edition-content">\n                <div><button id="m-zoomsandbox-button" class="icon-edition-zoom-sandbox" title="{{translations.zoom_sandbox}}"></button></div>\n                <div><button id="m-zoomselect-button" class="icon-edition-zoom-selection" title="{{translations.zoom_selection}}"></button></div>\n            </div>\n        </div>\n        <button id="m-draw-button" class="g-cartografia-editar" title="{{translations.geometry_draw}}"></button>\n        <button id="m-snapping-button" class="icon-edition-snapping" title="{{translations.snapping}}"></button>\n        <button id="m-modify-button" class="icon-edition-modify-polygon" title="{{translations.modify_polygon}}"></button>\n        <button id="m-splitpolygon-button" class="g-cartografia-linea" title="{{translations.geometry_divide}}"></button>\n        <button id="m-unir-button" class="icon-edition-union" title="{{translations.union}}"></button>\n        <button id="m-vaciado-button" class="icon-edition-empty-polygon" title="{{translations.empty_polygon}}"></button>\n        <button id="m-intersect-button" class="icon-edition-intersection" title="{{translations.intersection}}"></button>\n        <button id="m-removefromsandbox-button" class="icon-edition-delete-selected" title="{{translations.delete_selected}}"></button>\n    </div>\n</div>'},function(e,t){e.exports='<div class="m-dialog {{severity}}">\n   <div class="m-modal">\n      <div class="m-content">\n         <div class="m-title">\n            <i class="m-icon"></i>\n            <span>{{{title}}}</span>\n         </div>\n         <div class="m-message">{{{message}}}\n            {{#if layers}}\n            <br>\n            <select class="m-layer-selection">\n               {{#each layers}}\n               <option value="{{{this.name}}}">{{this.name}}</option>\n               {{/each}}\n             </select> \n             {{/if}}\n         </div>\n         <div id="m-edition-dialog-button-aceptar" class="m-edition-dialog-button">\n            <button>{{translations.accept_btn}}</button>\n         </div>\n         <div id="m-edition-dialog-button-cancelar" class="m-edition-dialog-button">\n            <button>{{translations.cancel_btn}}</button>\n         </div>\n      </div>\n   </div>\n</div>'},function(e){e.exports=JSON.parse('{"tooltip":"Edition Tools","import_btn":"Import geometry from vector layer","select_btn":"Select","select_click":"Select by click","select_line":"Select by line","select_area":"Select by area","select_all":"Select all geometry","deselect_all":"Deselect all geometries","zoom":"Zoom","zoom_sandbox":"Zoom to working layer","zoom_selection":"Zoom to selected geometries","geometry_draw":"Draw geometry","snapping":"Activate snapping","modify_polygon":"Modify geometry","geometry_divide":"Divide geometry","union":"Group geometries","empty_polygon":"Empty","intersection":"Geometry intersect","delete_selected":"Remove selected geometries from working layer","accept_btn":"Accept","cancel_btn":"Cancel","dialog_removeFeatures":"The selected geometries will be removed. Do you want to continue?","dialog_removeFeatures_title":"Remove geomtries","dialog_removeFeatures_noGeometry":"No geometries selected","snapping_disable":"Deactivate snapping","dialog_noGeometry":"There are no geometries in the working layer","dialog_noGeometry_selected":"No geometries selected in working","dialog_noValidGeometry":"The geometry is not valid","dialog_atLeast_oneSelected":"You must select at least one geometry","dialog_union":"The selected geometries will be grouped Do you want to continue?","dialog_union_title":"Group geometries","dialog_atLeast_twoSelected":"You must select at least two geometry","dialog_intersect_title":"Intersection","dialog_empty_title":"Empty","dialog_add_geometry":"The geometries of the selected layer will be added. Do you want to continue?","dialog_add_geometry_title":"Copy geometries","dialog_zoom_title":"Zoom to working layer","dialog_zoom_select":"Zoom to selection","dialog_not_found":"Not found: ","dialog_cannot_consult":"The query has not been made"}')},function(e){e.exports=JSON.parse('{"tooltip":"Herramientas de edición","import_btn":"Importar geometría desde capa vectorial","select_btn":"Seleccionar","select_click":"Seleccionar por click","select_line":"Seleccionar por línea","select_area":"Seleccionar por área","select_all":"Seleccionar todas las geometrías","deselect_all":"Deseleccionar todas las geometrías","zoom":"Zoom","zoom_sandbox":"Zoom a la capa de trabajo","zoom_selection":"Zoom a las geometrías seleccionadas","geometry_draw":"Dibujar geometría","snapping":"Activar snapping","modify_polygon":"Modificar geometría","geometry_divide":"Dividir geometría","union":"Unir geometrías","empty_polygon":"Vaciado","intersection":"Intersección de geometrías","delete_selected":"Eliminar geometrías seleccionadas de la capa de trabajo","accept_btn":"Aceptar","cancel_btn":"Cancelar","dialog_removeFeatures":"Se eliminarán las geometrías seleccionadas ¿Desea continuar?","dialog_removeFeatures_title":"Eliminar geometrías","dialog_removeFeatures_noGeometry":"No hay geometrías seleccionadas","snapping_disable":"Desactivar snapping","dialog_noGeometry":"No hay geometrías en la capa de trabajo","dialog_noGeometry_selected":"No hay geometrías seleccionadas en la capa de trabajo","dialog_noValidGeometry":"La geometría no es válida","dialog_atLeast_oneSelected":"Debe seleccionar al menos una geometría","dialog_union":"Se unirán las geometrías seleccionadas ¿Desea continuar?","dialog_union_title":"Unir geometrías","dialog_atLeast_twoSelected":"Debe seleccionar al menos dos geometrías","dialog_intersect_title":"Intersección","dialog_empty_title":"Vaciado","dialog_add_geometry":"Se añadirán las geometrías de la capa seleccionada ¿Desea continuar?","dialog_add_geometry_title":"Copiar geometrías","dialog_zoom_title":"Zoom a la capa de trabajo","dialog_zoom_select":"Zoom a la selección","dialog_not_found":"No se han encontrado ","dialog_cannot_consult":"No se ha podido realizar la consulta"}')},function(e){e.exports=JSON.parse('{"url":{"name":"edition","separator":"*"},"constructor":"M.plugin.Edition","parameters":[],"files":{"ol":{"scripts":["edition.ol.min.js"],"styles":["edition.ol.min.css"]}},"metadata":{"name":"Edition","description":"Edición de geoprocesos","text":"Plugin que permite editar capas existentes en el mapa, o creadas por el propio usuario","version":"1.1.0","date":"Junio, 2020","author":"","org":"Consejería de Agricultura, Ganadería, Pesca y Desarrollo Sostenible de la Junta de Andalucía.","tags":"mapea,plugin","icon":"./facade/assets/icons/icons.svg","centralized":true}}')},function(e,t,o){},function(e,t,o){"use strict";o.r(t);o(5);var n=o(0),r=o.n(n);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=l(this,s(t).call(this))).base_=e,o.map_=e.facadeMap_,o.ol3Layer_=null,o.isVisible_=!0,o.isModified_=!1,o.sandBoxFeatures_=[],o.sandBoxLayer_=null,o.selectedFeatures_=[],o.deletedFeatures_=[],o.geometry=void 0,o.type_="MultiPolygon",o.addTo(o.map_),o}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,M.impl.Layer),o=t,(n=[{key:"addTo",value:function(){this.sandBoxLayer_=new M.layer.Vector,this.sandBoxLayer_.name="editionLayer",this.sandBoxLayer_.setZIndex(M.impl.Map.Z_INDEX[M.layer.type.WFS]+999),this.map_.addLayers(this.sandBoxLayer_),this.ol3Layer_=this.sandBoxLayer_.getImpl().getOL3Layer(),this.ol3Layer_.setStyle(this.selectableStyle(this.getSandBoxStyle())),this.sandBoxLayer_.setStyle(new M.style.Polygon({fill:{color:"red",opacity:.5},stroke:{color:"#FF0000",width:2}})),this.setVisible(!0)}},{key:"setStyle",value:function(e){this.sandBoxLayer_.setStyle(e)}},{key:"selectableStyle",value:function(e){var t=this;return function(){return null===t.base_.highlightControl.getImpl().highlightInteraction_||-1==t.base_.highlightControl.getImpl().highlightInteraction_.getFeatures().getArray().indexOf(this)?e:t.base_.highlightControl.getImpl().highlightStyle}}},{key:"getType",value:function(){return this.type_}},{key:"setType",value:function(e){this.type_=e,"MultiPoint"===e||"Point"===e?this.sandBoxLayer_.setStyle(new M.style.Point({radius:5,fill:{color:"red",opacity:.5},stroke:{color:"#FF0000"}})):"MultiPolygon"!==e&&"Polygon"!==e||this.sandBoxLayer_.setStyle(new M.style.Polygon({fill:{color:"red",opacity:.5},stroke:{color:"#FF0000",width:2}}))}},{key:"getImplLayer",value:function(){return this.ol3Layer_}},{key:"getImplFeature",value:function(e){return e.getImpl().getOLFeature()}},{key:"getFeatureCollectionById",value:function(e){for(var t=this.ol3Layer_.getSource().getFeatures(),o=0;o<t.length;o++)if(t[o].getId()===e)return new ol.Collection([t[o]])}},{key:"getFeatureCollection",value:function(){var e=this.ol3Layer_.getSource().getFeatures();return new ol.Collection([e])}},{key:"getSelectedFeatureCollection",value:function(){for(var e=[],t=0;t<this.selectedFeatures_.length;t++)e.push(this.selectedFeatures_[t].getImpl().getOLFeature());return new ol.Collection(e)}},{key:"getOLFeatures",value:function(){return this.ol3Layer_.getSource().getFeatures()}},{key:"getFeatures",value:function(){return this.sandBoxLayer_.getFeatures()}},{key:"addFeatures",value:function(e){return this.sandBoxLayer_.addFeatures(e)}},{key:"hasGeometry",value:function(){return this.ol3Layer_.getSource().getFeatures().length>0}},{key:"getGeometry",value:function(){return this.geometry}},{key:"getCoordinatesFromFeature",value:function(e){return e.getGeometry().getCoordinates()}},{key:"getCoordinatesFromFeatureById",value:function(e){var t=this.getFeatureById(e);return null!==t?t.getGeometry().getCoordinates():null}},{key:"readGML3Features",value:function(e){var t=new ol.proj.Projection({code:"http://www.opengis.net/gml/srs/epsg.xml#25830",axis:"enu"});return ol.proj.addEquivalentProjections([ol.proj.get(this.map_.getProjection().code),t]),(new ol.format.GML3).readFeatures(e,this.map_.getProjection())}},{key:"addFeature",value:function(e){var t=(new ol.format.GeoJSON).writeFeatureObject(e),o=new M.Feature(e.getId(),t);return this.sandBoxLayer_.addFeatures(o),o}},{key:"removeFeatureById",value:function(e){var t=this.sandBoxLayer_.getFeatureById(e);return void 0!==t&&(this.sandBoxFeatures_=[],this.selectedFeatures_=[],this.sandBoxLayer_.removeFeatures([t]),this.deletedFeatures_.push(t),this.isModified_=!0,[t.getId()])}},{key:"removeFeature",value:function(e){var t=this;this.sandBoxLayer_.getFeatures().forEach((function(o){o===e&&t.sandBoxLayer_.removeFeatures([o])}))}},{key:"removeAllFeatures",value:function(){var e=this.sandBoxLayer_.getFeatures();return this.sandBoxLayer_.removeFeatures(e),Array.prototype.push.apply(this.deletedFeatures_,e),this.sandBoxFeatures_=[],this.selectedFeatures_=[],this.isModified_=!0,!0}},{key:"addFeaturesToSandBox",value:function(e){var t=this;e.forEach((function(e,o,n){for(var r=!1,i=0;i<t.sandBoxLayer_.getFeatures().length;i++)if(t.sandBoxLayer_.getFeatures()[i].getImpl().getId()===Number(e.id)){r=!0;break}if(!r){var a={type:"Feature",geometry:{type:e.type,coordinates:e.coordinates}},l=new M.Feature(e.id,a);t.sandBoxLayer_.addFeatures(l)}}))}},{key:"addNewFeatureToSandBox",value:function(e){var t=(new ol.format.GeoJSON).writeFeatureObject(e),o=new M.Feature(e.getId(),t);this.sandBoxLayer_.addFeatures(o)}},{key:"addNewMFeatureToSandBox",value:function(e){this.sandBoxLayer_.addFeatures(e)}},{key:"removeFeaturesFromSandBox",value:function(e){for(var t=e.length;t--;){var o=this.sandBoxLayer_.getFeatureById(e[t].getId());void 0!==o&&(o instanceof M.Feature?this.unselectFeature(o.getImpl().getOLFeature()):this.unselectFeature(o),this.sandBoxLayer_.removeFeatures(o))}}},{key:"selectFeature",value:function(e){var t=this.sandBoxLayer_.getFeatureById(e.getId());void 0!==t&&(t.getImpl().getOLFeature().setStyle(this.selectableStyle(this.getSelectedStyle())),this.selectedFeatures_.push(t))}},{key:"unselectFeature",value:function(e){for(var t=this.selectedFeatures_.length;t--;)this.selectedFeatures_[t].getImpl().getOLFeature().getId()===e.getId()&&(this.selectedFeatures_[t].getImpl().getOLFeature().setStyle(this.selectableStyle(this.getSandBoxStyle())),this.selectedFeatures_.splice(t,1))}},{key:"selectAllFeatures",value:function(){for(var e=this.sandBoxLayer_.getFeatures(),t=0;t<e.length;t++)this.selectedFeatures_.length>0?-1===this.selectedFeatures_.indexOf(e[t])&&this.selectFeature(e[t]):this.selectFeature(e[t])}},{key:"unselectAllFeatures",value:function(){for(var e=this.sandBoxLayer_.getFeatures(),t=0;t<e.length;t++)e[t].getImpl().getOLFeature().setStyle(this.selectableStyle(this.getSandBoxStyle()));this.selectedFeatures_=[]}},{key:"getGeometriesExtension",value:function(){var e=this.ol3Layer_.getSource().getFeatures(),t=new ol.extent.createEmpty;return e.forEach((function(e,o,n){ol.extent.extend(t,e.getGeometry().getExtent())})),t}},{key:"getOLFeaturesExtensionByAttribute",value:function(e,t){for(var o=[],n=0;n<e.length;n++){var r=this.getOLFeatureByUniqueAttribute(Number(e[n]),t);o.push(r)}var i=new ol.extent.createEmpty;return o.forEach((function(e,t,o){null!==e&&ol.extent.extend(i,e.getGeometry().getExtent())})),i}},{key:"getOLFeaturesExtension",value:function(e){for(var t=[],o=0;o<e.length;o++){var n=e[o].getImpl().getOLFeature();t.push(n)}var r=new ol.extent.createEmpty;return t.forEach((function(e,t,o){null!==e&&ol.extent.extend(r,e.getGeometry().getExtent())})),r}},{key:"zoomToLayer",value:function(){if(this.ol3Layer_.getSource().getFeatures().length>0){var e=this.ol3Layer_.getSource().getFeatures(),t=new ol.extent.createEmpty;e.forEach((function(e){ol.extent.extend(t,e.getGeometry().getExtent())})),this.map_.getMapImpl().getView().fit(t,{duration:500})}}},{key:"zoomToFeatures",value:function(e){try{var t=M.impl.utils.getFeaturesExtent(e);this.map_.setBbox(t)}catch(e){M.dialog.info("No existe ninguna geometría asociada")}}},{key:"zoomToFeaturesByIdsArray",value:function(e,t){try{var o=this.getOLFeaturesExtensionByAttribute(e,t);this.map_.getMapImpl().getView().fit(o,{maxZoom:12,duration:500})}catch(e){M.dialog.info("No existe ninguna geometría asociada")}}},{key:"zoomToFeatureById",value:function(e){var t=this.getFeatureById(e);if(null!==t){var o=new ol.extent.createEmpty;ol.extent.extend(o,t.getGeometry().getExtent()),this.map_.getMapImpl().getView().fit(o,{maxZoom:12,duration:500})}}},{key:"getMFeatureByUniqueAttribute",value:function(e,t){for(var o=this.sandBoxLayer_.getFeatures(),n=0;n<o.length;n++)if(o[n].getAttribute(t)===e)return o[n]}},{key:"getFeatureById",value:function(e){var t=null;return this.ol3Layer_.getSource().getFeatures().length>0&&this.ol3Layer_.getSource().getFeatures().forEach((function(o,n,r){if(o.getId()===e)return t=o,!0})),t}},{key:"getMFeatureById",value:function(e){return this.sandBoxLayer_.getFeatureById(e)}},{key:"getOLFeatureByUniqueAttribute",value:function(e,t){var o=null;return this.ol3Layer_.getSource().getFeatures().length>0&&this.ol3Layer_.getSource().getFeatures().forEach((function(n,r,i){if(n.get(t)===e)return o=n,!0})),o}},{key:"getDeletedFeatures",value:function(){return this.deletedFeatures_}},{key:"clearDeletedFeaturesArray",value:function(){this.deletedFeatures_=[]}},{key:"rollbackFeatures",value:function(e){this.ol3Layer_.getSource().addFeatures(e)}},{key:"clear",value:function(){this.ol3Layer_.getSource().clear()}},{key:"refresh",value:function(){this.ol3Layer_.getSource().refresh()}},{key:"destroy",value:function(){var e=this.map_.getMapImpl();M.utils.isNullOrEmpty(this.ol3Layer_)||(e.removeLayer(this.ol3Layer_),this.ol3Layer_=null),this.map_.removeLayers(this.sandBoxLayer_),this.map_=null,this.popup_=null,this.sandBoxFeatures_=[],this.name=null}},{key:"getSandBoxStyle",value:function(){return new ol.style.Style({fill:new ol.style.Fill({color:[93,95,229,.2]}),stroke:new ol.style.Stroke({color:"blue",width:2})})}},{key:"getSelectedStyle",value:function(){return new ol.style.Style({fill:new ol.style.Fill({color:[249,232,6,.1]}),stroke:new ol.style.Stroke({color:"yellow",width:2})})}}])&&a(o.prototype,n),r&&a(o,r),t}();function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e,t,o){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(o):r.value}})(e,t,o||e)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){function t(e,o){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=d(this,h(t).call(this))).layer_=o,n.modifiedFeatures=[],n.interactions_=[],n}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,M.impl.Control),o=t,(n=[{key:"addTo",value:function(e,o){p(h(t.prototype),"addTo",this).call(this,e,o)}},{key:"activate",value:function(e,t,o){if(this.interactions_.length<1){this.createInteraction(e,t,o);for(var n=0;n<this.interactions_.length;n++)this.layer_.map_.getMapImpl().addInteraction(this.interactions_[n])}for(var r=0;r<this.layer_.map_.getControls().length;r++)this.layer_.map_.getControls()[r].activated&&this.layer_.map_.getControls()[r].deactivate();for(var i=0;i<this.interactions_.length;i++)this.interactions_[i].setActive(!0)}},{key:"deactivate",value:function(){if(this.interactions_.length>0){for(var e=0;e<this.interactions_.length;e++)this.interactions_[e].setActive(!1),this.layer_.map_.getMapImpl().removeInteraction(this.interactions_[e]);this.interactions_=[]}}},{key:"destroy",value:function(){this.layer_.map_.getMapImpl().removeControl(this),this.layer_=null,this.interactions_=[],this.modifiedFeatures=null}}])&&f(o.prototype,n),r&&f(o,r),t}();function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var F=function(e){function t(e,o){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=_(this,w(t).call(this,e,o))).map_=e,n.selectInteraction_=null,n}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,e),o=t,(n=[{key:"createInteraction",value:function(e,t){this.selectInteraction_=new ol.interaction.Select({layers:[this.layer_.sandBoxLayer_.getImpl().getOL3Layer()],multi:!0,condition:ol.events.condition.click}),this.selectInteraction_.on("select",e,this),this.interactions_.push(this.selectInteraction_)}}])&&b(o.prototype,n),r&&b(o,r),t}(m);function P(e){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function L(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var B=function(e){function t(e,o){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(F)&&M.exception("La implementación usada no puede crear controles EditionSelectGeometry");var r=new F(e,o);return(n=L(this,k(t).call(this,r,"editionSelectGeometry"))).name="editionSelectGeometry",n}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}(t,M.Control),o=t,(n=[{key:"activate",value:function(e,t){this.getImpl().activate(e,t),this.activated=!0}},{key:"equals",value:function(e){return e instanceof M.control.EditionSelectGeometry}},{key:"setLayer",value:function(e){this.getImpl().layer_=e}}])&&O(o.prototype,n),r&&O(o,r),t}();function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function E(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function I(e,t,o){return(I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=T(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(o):r.value}})(e,t,o||e)}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function G(e,t){return(G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var N=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),E(this,T(t).call(this))}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&G(e,t)}(t,M.impl.Control),o=t,(n=[{key:"addTo",value:function(e,o){var n=this;e.getMapImpl().getInteractions().forEach((function(e){e instanceof ol.interaction.DoubleClickZoom&&(n.dblClickInteraction_=e)})),I(T(t.prototype),"addTo",this).call(this,e,o)}},{key:"activateClick",value:function(e){this.dblClickInteraction_.setActive(!1),e.getMapImpl().on("dblclick",(function(t){var o=new CustomEvent("mapclicked",{detail:t.coordinate,bubbles:!0});e.getContainer().dispatchEvent(o)}))}},{key:"deactivateClick",value:function(e){this.dblClickInteraction_.setActive(!0),e.getMapImpl().removeEventListener("dblclick")}}])&&j(o.prototype,n),r&&j(o,r),t}();function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function A(e,t){return!t||"object"!==z(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var J=function(e){function t(e,o){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=A(this,q(t).call(this,e,o))).map_=e,n.highlightInteraction_=null,n}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(t,e),o=t,(n=[{key:"createInteraction",value:function(e,t){this.highlightStyle=[new ol.style.Style({fill:new ol.style.Fill({color:[249,177,10,.2]})}),new ol.style.Style({stroke:new ol.style.Stroke({color:"orange",width:2.5})})],this.highlightInteraction_=new ol.interaction.Select({layers:[this.layer_.sandBoxLayer_.getImpl().getOL3Layer()],condition:ol.events.condition.pointerMove,style:this.highlightStyle}),this.interactions_.push(this.highlightInteraction_)}}])&&D(o.prototype,n),r&&D(o,r),t}(m);function V(e){return(V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Z(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function U(e,t){return!t||"object"!==V(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function W(e){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function H(e,t){return(H=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var X=function(e){function t(e,o){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(J)&&M.exception("La implementación usada no puede crear controles EditionHighlightGeometry");var r=new J(e,o);return(n=U(this,W(t).call(this,r,"editionHighlightGeometry"))).name="editionHighlightGeometry",n}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&H(e,t)}(t,M.Control),o=t,(n=[{key:"activate",value:function(e,t){this.getImpl().activate(e,t),this.activated=!0}},{key:"deactivate",value:function(){this.getImpl().deactivate(),this.getImpl().highlightInteraction_=null}},{key:"equals",value:function(e){return e instanceof M.control.EditionHighlightGeometry}},{key:"setLayer",value:function(e){this.getImpl().layer_=e}}])&&Z(o.prototype,n),r&&Z(o,r),t}();function Y(e){return(Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function K(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Q(e,t){return!t||"object"!==Y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function $(e){return($=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ee(e,t){return(ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var te=function(e){function t(e,o){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Q(this,$(t).call(this,e,o))).map_=e,n.drawInteraction_=null,n}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ee(e,t)}(t,e),o=t,(n=[{key:"createInteraction",value:function(e,t,o){var n=null,r=this.layer_.getType();null!=o&&(r=o.getType());var i=this.getSimpleType(r);"Point"==r?n=new ol.style.Style({image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"withe"}),stroke:new ol.style.Stroke({color:[255,0,0],width:2})})}):"Polygon"==r&&(n=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:4,fill:new ol.style.Fill({color:"#ffcc33"})})})),this.drawInteraction_=new ol.interaction.Draw({type:i,style:n}),this.drawInteraction_.on("drawend",e,this),this.interactions_.push(this.drawInteraction_)}},{key:"getSimpleType",value:function(e){return"MultiPoint"===e||"Point"===e?"Point":"MultiPolygon"===e||"Polygon"===e?"Polygon":"MultiLineString"===e||"LineString"===e?"LineString":void 0}}])&&K(o.prototype,n),r&&K(o,r),t}(m);function oe(e){return(oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ne(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function re(e,t){return!t||"object"!==oe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ie(e){return(ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ae(e,t){return(ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var le=function(e){function t(e,o){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(te)&&M.exception("La implementación usada no puede crear controles EditionInsertGeometry");var r=new te(e,o);return(n=re(this,ie(t).call(this,r,"editionInsertGeometry"))).name="editionInsertGeometry",n}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ae(e,t)}(t,M.Control),o=t,(n=[{key:"activate",value:function(e,t,o){this.getImpl().activate(e,t,o),this.activated=!0}},{key:"equals",value:function(e){return e instanceof M.control.EditionInsertGeometry}},{key:"setLayer",value:function(e){this.getImpl().layer_=e}}])&&ne(o.prototype,n),r&&ne(o,r),t}();function se(e){return(se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ue(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ce(e,t){return!t||"object"!==se(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ye(e){return(ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fe(e,t){return(fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var de=function(e){function t(e,o){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=ce(this,ye(t).call(this,e,o))).map_=e,n.modifyInteraction_=null,n}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fe(e,t)}(t,e),o=t,(n=[{key:"createInteraction",value:function(e,t){var o=this.layer_.getSelectedFeatureCollection(),n=new ol.style.Style({image:new ol.style.Circle({radius:4,fill:new ol.style.Fill({color:"#ffcc33"})})});this.modifyInteraction_=new ol.interaction.Modify({features:o,deleteCondition:function(e){return ol.events.condition.shiftKeyOnly(e)&&ol.events.condition.singleClick(e)},style:n}),this.modifyInteraction_.on("modifyend",e,this),this.interactions_.push(this.modifyInteraction_)}}])&&ue(o.prototype,n),r&&ue(o,r),t}(m);function pe(e){return(pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function he(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ge(e,t){return!t||"object"!==pe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function me(e){return(me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ve(e,t){return(ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var be=function(e){function t(e,o){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(de)&&M.exception("La implementación usada no puede crear controles EditionModifyGeometry");var r=new de(e,o);return(n=ge(this,me(t).call(this,r,"editionModifyGeometry"))).name="editionModifyGeometry",n}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ve(e,t)}(t,M.Control),o=t,(n=[{key:"activate",value:function(e,t){this.getImpl().activate(e,t),this.activated=!0}},{key:"equals",value:function(e){return e instanceof M.control.EditionModifyGeometry}},{key:"setLayer",value:function(e){this.getImpl().layer_=e}}])&&he(o.prototype,n),r&&he(o,r),t}();function _e(e){return(_e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function we(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Se(e,t){return!t||"object"!==_e(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Fe(e){return(Fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pe(e,t){return(Pe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Oe=function(e){function t(e,o){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Se(this,Fe(t).call(this,e,o))).map_=e,n.drawInteraction_=null,n}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pe(e,t)}(t,e),o=t,(n=[{key:"createInteraction",value:function(e,t){var o=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffa733",width:2}),image:new ol.style.Circle({radius:4,fill:new ol.style.Fill({color:"#ffcc33"})})});this.drawInteraction_=new ol.interaction.Draw({type:"Point"===t?"Point":"LineString"===t?"LineString":"Polygon",style:o}),this.drawInteraction_.on("drawend",e,this),this.interactions_.push(this.drawInteraction_)}}])&&we(o.prototype,n),r&&we(o,r),t}(m);function Le(e){return(Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ke(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function xe(e,t){return!t||"object"!==Le(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Be(e){return(Be=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Me(e,t){return(Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ce=function(e){function t(e,o){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(Oe)&&M.exception("La implementación usada no puede crear controles EditionInsertLine");var r=new Oe(e,o);return(n=xe(this,Be(t).call(this,r,"editionInsertLine"))).name="editionInsertLine",n}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Me(e,t)}(t,M.Control),o=t,(n=[{key:"activate",value:function(e,t,o){this.getImpl().activate(e,t,o),this.activated=!0}},{key:"equals",value:function(e){return e instanceof M.control.EditionTemporalGeometry}}])&&ke(o.prototype,n),r&&ke(o,r),t}();function je(e){return(je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ee(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ie(e,t){return!t||"object"!==je(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Te(e){return(Te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ge(e,t){return(Ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ne=function(e){function t(e,o){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Ie(this,Te(t).call(this,e,o))).map_=e,n.snapInteraction_=null,n}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ge(e,t)}(t,e),o=t,(n=[{key:"createInteraction",value:function(e,t){this.snapInteraction_=new ol.interaction.Snap({source:this.layer_.getImplLayer().getSource()}),this.interactions_.push(this.snapInteraction_)}}])&&Ee(o.prototype,n),r&&Ee(o,r),t}(m);function ze(e){return(ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function De(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ae(e,t){return!t||"object"!==ze(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function qe(e){return(qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Re(e,t){return(Re=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Je=function(e){function t(e,o){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(Ne)&&M.exception("La implementación usada no puede crear controles EditionSnapping");var r=new Ne(e,o);return(n=Ae(this,qe(t).call(this,r,"editionSnapping"))).name="editionSnapping",n}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Re(e,t)}(t,M.Control),o=t,(n=[{key:"activate",value:function(e,t){this.getImpl().activate(e,t),this.activated=!0}},{key:"equals",value:function(e){return e instanceof M.control.EditionSnapping}},{key:"setLayer",value:function(e){this.getImpl().layer_=e}}])&&De(o.prototype,n),r&&De(o,r),t}();function Ve(e){return(Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ze(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ue(e,t){return!t||"object"!==Ve(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function We(e,t,o){return(We="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=He(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(o):r.value}})(e,t,o||e)}function He(e){return(He=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Xe(e,t){return(Xe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ye=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=Ue(this,He(t).call(this))).map=e,o}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xe(e,t)}(t,M.impl.Control),o=t,(n=[{key:"addTo",value:function(e,o){We(He(t.prototype),"addTo",this).call(this,e,o)}},{key:"getFeaturesFromGeoJson",value:function(e){return(new ol.format.GeoJSON).readFeatures(e)}},{key:"getGeoJsonFromFeature",value:function(e){return(new ol.format.GeoJSON).writeFeatureObject(e)}},{key:"getFeatureRequestBody",value:function(e,t){var o=new ol.geom.Point(t),n=this.map.getProjection().code;return(new ol.format.WFS).writeGetFeature({srsName:n,featurePrefix:e.featurePrefix,featureTypes:e.featureTypes,outputFormat:e.outputFormat,maxFeatures:e.maxFeatures,filter:ol.format.filter.intersects(e.geomField,o,n)})}},{key:"getBbox",value:function(e){for(var t=ol.extent.boundingExtent([e,e]),o=0;o<t.length;o++)2!=o&&3!=o||(t[o]=t[o]+1e-10);return t}},{key:"getModifyStyle",value:function(e){return[new ol.style.Style({fill:new ol.style.Fill({color:"rgba(239,245,3,0.25)"}),stroke:new ol.style.Stroke({width:3,color:"rgba(239,245,3, 0.8)"})}),new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:"rgba(230,137,16, 0.8)"})}),geometry:function(t){var o=e.getGeometry().getCoordinates()[0];return"MultiPolygon"===e.getGeometry().getType()&&(o=e.getGeometry().getCoordinates()[0][0]),new ol.geom.MultiPoint(o)}})]}},{key:"createOLPolygonFeature",value:function(e){for(var t,o=e.getGeometry(),n=0;n<o.coordinates.length;n++){var r=o.coordinates[n];t=new M.Feature(Math.floor(1e6*Math.random()),{type:"Polygon",geometry:r,geometry_name:"geometry",properties:{}})}return t}}])&&Ze(o.prototype,n),r&&Ze(o,r),t}(),Ke=o(1),Qe=o.n(Ke),$e={en:o(2),es:o(3)},et=function(){var e="es";return"function"==typeof M.language.getLang&&(e=M.language.getLang()),e},tt=function(e){return $e[e]},ot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:et(),o=tt(t),n="";return M.utils.isNullOrEmpty(o)?console.warn("The translation '".concat(t,"' has not been defined.")):n=e.split(".").reduce((function(e,t){return e[t]}),o),n},nt=function(e,t,o,n,r,i){var a=M.template.compileSync(Qe.a,{jsonp:!1,vars:{message:e,title:t,severity:o,layers:i,translations:{accept_btn:ot("accept_btn"),cancel_btn:ot("cancel_btn")}}});it(a,n,r)},rt=function(){var e=document.querySelector("div.m-dialog");document.querySelector("div.m-mapea-container").removeChild(e)},it=function(e,t,o){var n=document.querySelector("div.m-mapea-container"),r=e.querySelector("#m-edition-dialog-button-aceptar > button"),i=e.querySelector("#m-edition-dialog-button-cancelar > button");void 0===o?i.addEventListener("click",rt,!1):i.addEventListener("click",o,!1);var a=e.querySelector(".m-layer-selection");a?r.addEventListener("click",(function(){t(a.value)}),!1):r.addEventListener("click",t,!1),n.appendChild(e)},at=function(e){return(new jsts.io.GeoJSONWriter).write(e)},lt=function(e,t){var o=new M.Feature(e.getId(),e.getGeoJSON());return o.setGeometry(st(e.getGeometry(),t.getGeometry())),o},st=function(e,t){var o=ft(e),n=ft(t),r=o.union(n);return at(r)},ut=function(e,t){var o=ft(t),n=[];return e.forEach((function(e){ft(e.getGeometry()).intersects(o)&&n.push(e)})),n},ct=function(e,t){var o=ft(e.getGeometry()),n=ft(t.getGeometry()),r=o.intersection(n);return at(r)},yt=function(e,t){var o=ft(t.getGeometry()),n=ft(e.getGeometry()).difference(o);return at(n)},ft=function(e){return(new jsts.io.GeoJSONReader).read(e)},dt=function(e,t){var o=ft(t.getGeometry());void 0!==o._geometries&&(o=o._geometries[0]);var n=ft(e.getGeometry());try{var r=o.getExteriorRing().union(n),i=new jsts.operation.polygonize.Polygonizer;i.add(r);var a=i.getPolygons(),l=a,s=null;if(a.size()<2)try{var u=t.getGeometry(),c=turf.polygonToLine(u);c.geometry.coordinates.push(e.getGeometry().coordinates);var y=turf.lineToPolygon(c);return s=turf.polygon([y.geometry.coordinates[y.geometry.coordinates.length-1]]),mt(s,t)}catch(e){return null}var f=o.getExteriorRing(),d=new jsts.operation.polygonize.Polygonizer;if(d.add(f),i.getGeometry().getArea()-d.getGeometry().getArea()>.1)return-1;if(o.getNumInteriorRing()>0){if(n.isSimple()){var p=ht(i,o);return gt(null,p,t)}return s=pt(o,n),gt(s,o,t)}return a.size()<2?null:vt(l,t)}catch(e){return}},pt=function(e,t){var o=new jsts.operation.polygonize.Polygonizer,n=e.getExteriorRing().union(t);o.add(n);for(var r=o.getPolygons().iterator();r.hasNext();){var i=r.next();if(i._holes.length>0)return o.add(i._holes[0]),o.getPolygons().get(0)}return!1},ht=function(e,t){for(var o=e.getPolygons(),n=new jsts.operation.polygonize.Polygonizer,r=o.get(0),i=null,a=0;a<t._holes.length;a++)n.add(t._holes[a]);var l=n.getPolygons();2===o.size()&&(i=o.get(1));for(var s=l.iterator();s.hasNext();){var u=s.next();r=r.difference(u),null!==i&&(i=i.difference(u))}var c=[];return c.push(r),null!==i&&c.push(i),c},gt=function(e,t,o){var n,r,i=[],a=1,l=[];if(null!==e){var s=o.getGeometry(),u=t.difference(e),c=e.intersection(t),y=at(u),f=at(c);if(null===y||null===f)return-1;s=y,e=f,l.push(s),l.push(e);for(var d=0;d<l.length;d++)r=new M.Feature(Math.random(),{type:"Feature",id:Math.random(),geometry:l[d],geometry_name:"geometry",properties:{}}),i.push(r),a+=a}else{l=t;for(var p=0;p<l.length;p++)n=at(l[p]),r=new M.Feature(Math.random(),{type:"Feature",id:Math.random(),geometry:n,geometry_name:"geometry",properties:{}}),i.push(r),a++}return i},mt=function(e,t){var o=[],n=1,r=[],i=t.getGeometry(),a=i;try{if(!turf.booleanContains(a,e)&&!turf.booleanOverlap(a,e))return-1;var l=ft(i),s=ft(e.geometry),u=l.difference(s),c=s.intersection(l),y=at(u),f=at(c);if(null===y||null===f)return-1;a.geometry=y,e.geometry=f,r.push(a),r.push(e)}catch(e){return-2}for(var d=0;d<r.length;d++){var p=new M.Feature(Math.random(),{type:"Feature",id:Math.random(),geometry:r[d],geometry_name:"geometry",properties:{}});o.push(p),n+=n}return o},vt=function(e,t){for(var o=[],n=1,r=e.iterator();r.hasNext();){var i=r.next(),a=at(i),l=new M.Feature(Math.random(),t.getGeoJSON());l.setGeometry(a),o.push(l),n+=n}return o};function bt(e){return(bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _t(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function wt(e,t){return!t||"object"!==bt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function St(e){return(St=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ft(e,t){return(Ft=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Pt=function(e){function t(e){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(Ye)&&M.exception("La implementación usada no puede crear controles EditionGeometryControl");var n=new Ye(e.facadeMap_);return(o=wt(this,St(t).call(this,n,"editionGeometryControl"))).NAME="editionGeometryControl",o.impl_=n,o.facadeMap_=e.facadeMap_,o.base=e,o.element_=e.element_,o.entityLayer_=e.sandBoxLayer_,o.insertGeomControl=o.base.insertGeomControl,o.insertTemporalGeomControl=o.base.insertTemporalGeomControl,o.modifyGeomControl=o.base.modifyGeomControl,o.translateGeomControl=o.base.translateGeomControl,o.selectGeomControl=o.base.selectGeomControl,o.snappingControl=o.base.snappingControl,o.highlightControl=o.base.highlightControl,o.entityAddWFSControl=null,o.insertPolygonButton=null,o.selectPolygonButton=null,o.selectPolygonByAreaButton=null,o.selectPolygonByLineButton=null,o.selectAllSandboxPolygonButton=null,o.modifyPolygonButton=null,o.dividePolygonButton=null,o.joinPolygonsButton=null,o.intersectPolygonButton=null,o.emptyPolygonButton=null,o.zoomToSelectedButton=null,o.addGeomButton=null,o.WFSManagerCtl=null,o.addEvents(),o}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ft(e,t)}(t,e),o=t,(n=[{key:"addEvents",value:function(){this.self_=this,this.snappingButton=this.element_.querySelector("#m-snapping-button"),this.snappingButton.addEventListener("click",this.activateSnapping.bind(this),!1),this.zoomMenuElement=this.element_.querySelector("#m-zoommenu-button"),this.zoomMenuPolygonButton=this.element_.querySelector("#m-zoom-button"),this.zoomMenuPolygonButtonClass=this.zoomMenuPolygonButton.classList.value,this.zoomMenuPolygonButton.addEventListener("click",this.manageSelectedClassInDropdown,!1),this.zoomMenuElement.addEventListener("mouseover",this.showDropdownContent,!1),this.zoomMenuElement.addEventListener("mouseout",this.hideDropdownContent,!1),this.zoomDropdownMenu=this.zoomMenuElement.querySelector("#myDropdown"),this.zoomToSandBoxButton=this.element_.querySelector("button#m-zoomsandbox-button"),this.zoomToSandBoxButton.addEventListener("click",this.zoomToSandBox.bind(this),!1),this.zoomToSelectedButton=this.element_.querySelector("button#m-zoomselect-button"),this.zoomToSelectedButton.addEventListener("click",this.zoomToSelection.bind(this),!1),this.selectMenuElement=this.element_.querySelector("#m-selectmenu-button"),this.selectMenuPolygonButton=this.element_.querySelector("#m-select-button"),this.selectMenuPolygonButtonClass=this.selectMenuPolygonButton.classList.value,this.selectMenuPolygonButton.addEventListener("click",this.manageSelectedClassInDropdown,!1),this.selectMenuElement.addEventListener("mouseover",this.showDropdownContent,!1),this.selectDropdownMenu=this.selectMenuElement.querySelector("#myDropdown"),this.selectMenuElement.addEventListener("mouseout",this.hideDropdownContent,!1),this.removeFromSandBoxButton=this.element_.querySelector("button#m-removefromsandbox-button"),this.removeFromSandBoxButton.addEventListener("click",this.removeSelectedFeaturesFromSandBox.bind(this),!1),this.selectPolygonButton=this.element_.querySelector("button#m-selectclick-button"),this.selectPolygonButton.addEventListener("click",this.selectPolygonByClick.bind(this),!1),this.selectPolygonByAreaButton=this.element_.querySelector("button#m-selectarea-button"),this.selectPolygonByAreaButton.addEventListener("click",this.selectPolygonByDraw.bind(this),!1),this.selectPolygonByLineButton=this.element_.querySelector("button#m-selectline-button"),this.selectPolygonByLineButton.addEventListener("click",this.selectPolygonByDraw.bind(this),!1),this.selectAllSandboxPolygonButton=this.element_.querySelector("button#m-selectall-button"),this.selectAllSandboxPolygonButton.addEventListener("click",this.selectAllSandboxPolygon.bind(this),!1),this.deselectAllSandboxPolygonButton=this.element_.querySelector("button#m-deselectall-button"),this.deselectAllSandboxPolygonButton.addEventListener("click",this.deselectAllSandboxPolygon.bind(this),!1),this.insertPolygonButton=this.element_.querySelector("button#m-draw-button"),this.insertPolygonButton.addEventListener("click",this.insertPolygon.bind(this),!1),this.modifyPolygonButton=this.element_.querySelector("button#m-modify-button"),this.modifyPolygonButton.addEventListener("click",this.modifyPolygon.bind(this),!1),this.dividePolygonButton=this.element_.getElementsByTagName("button")["m-splitpolygon-button"],this.dividePolygonButton.addEventListener("click",this.dividePolygon.bind(this),!1),this.joinPolygonsButton=this.element_.querySelector("button#m-unir-button"),this.joinPolygonsButton.addEventListener("click",this.confirmDialogJoinPolygons.bind(this),!1),this.addGeomButton=this.element_.querySelector("button#m-addgeometry-button"),this.addGeomButton.addEventListener("click",this.addGeom.bind(this),!1),this.intersectPolygonButton=this.element_.querySelector("button#m-intersect-button"),this.intersectPolygonButton.addEventListener("click",this.intersectPolygon.bind(this),!1),this.emptyPolygonButton=this.element_.querySelector("button#m-vaciado-button"),this.emptyPolygonButton.addEventListener("click",this.emptyPolygon.bind(this),!1)}},{key:"showDropdownContent",value:function(e){""!==e.currentTarget.children[1].style.width&&"0px"!==e.currentTarget.children[1].style.width||(e.currentTarget.children[0].style.float="left",e.currentTarget.children[1].style.left="40px","m-zoommenu-button"===e.currentTarget.id?e.currentTarget.children[1].style.width="80px":e.currentTarget.children[1].style.width="200px",e.currentTarget.children[1].style.borderTopRightRadius="4px",e.currentTarget.children[1].style.borderBottomRightRadius="4px",e.currentTarget.children[0].style.marginBottom="-4px")}},{key:"hideDropdownContent",value:function(e){e.currentTarget.children[1].style.width="0px"}},{key:"manageSelectedClassInDropdown",value:function(e){var t;"m-select-button"===e.currentTarget.id&&"g-cartografia-flecha"!==e.currentTarget.classList.value?"g-cartografia-flecha"===this.selectMenuPolygonButtonClass&&(t=this.selectMenuPolygonButtonClass,e.currentTarget.nextElementSibling.style.width="0px",e.currentTarget.classList.value=t,this.deactiveControls()):null!==e.currentTarget.offsetParent.previousElementSibling&&"m-zoom-button"!==e.currentTarget.offsetParent.previousElementSibling.id&&(t=e.currentTarget.classList.value,e.currentTarget.offsetParent.style.width="0px",e.currentTarget.offsetParent.previousElementSibling.classList.value=t)}},{key:"restoreDefaultClassDropdownButtons",value:function(){this.selectMenuPolygonButton.classList.value=this.selectMenuPolygonButtonClass}},{key:"removeSelectedFeaturesFromSandBox",value:function(e){if(this.entityLayer_.selectedFeatures_.length>0){var t=this.removeSelectedFeatures.bind(this);nt(ot("dialog_removeFeatures"),ot("dialog_removeFeatures_title"),"info",t)}else M.dialog.info(ot("dialog_removeFeatures_noGeometry"),ot("dialog_removeFeatures_title"))}},{key:"removeSelectedFeatures",value:function(){this.deactiveControls(),this.unselectControls(),this.entityLayer_.removeFeaturesFromSandBox(this.entityLayer_.selectedFeatures_),rt()}},{key:"activateSnapping",value:function(e){e.currentTarget.className.indexOf("selected")<0?(e.currentTarget.className+=" selected",e.currentTarget.title=ot("snapping_disable"),this.snappingControl.activate(null,null)):(e.currentTarget.title=ot("snapping"),e.currentTarget.className=this.snappingButton.className.replace(" selected",""),this.snappingControl.deactivate())}},{key:"insertPolygon",value:function(e){if(this.restoreDefaultClassDropdownButtons(),this.deactiveControls(),e.currentTarget.className.indexOf("selected")<0){this.unselectControls(),e.currentTarget.className+=" selected";var t=this.onPolygonInserted.bind(this);this.insertGeomControl.activate(t),this.snappingControl.deactivate(),this.snappingButton.className.indexOf("selected")>0&&this.snappingControl.activate(null,null)}else this.unselectControls()}},{key:"onPolygonInserted",value:function(e){this.entityLayer_.addNewFeatureToSandBox(e.feature)}},{key:"selectPolygonByClick",value:function(e){if(this.manageSelectedClassInDropdown(e),this.deactiveControls(),e.currentTarget.offsetParent.previousElementSibling.className.indexOf("selected")<0){this.unselectControls(),e.currentTarget.offsetParent.previousElementSibling.className+=" selected";var t=this.onPolygonSelected.bind(this);this.selectGeomControl.activate(t)}else this.showDropdownContent()}},{key:"onPolygonSelected",value:function(e){var t=this,o=null;if(e.selected.length>0){if(this.entityLayer_.getFeatures().forEach((function(n,r,i){for(var a=0;a<e.selected.length;a++)e.selected[a].getId()===t.entityLayer_.getImplFeature(n).getId()&&(o=e.selected[a])})),null!==o){var n=null;this.entityLayer_.selectedFeatures_.forEach((function(o,r,i){for(var a=0;a<e.selected.length;a++)e.selected[a].getId()===t.entityLayer_.getImplFeature(o).getId()&&(n=e.selected[a])})),null===n?this.entityLayer_.selectFeature(o):this.entityLayer_.unselectFeature(o)}e.target.getFeatures().clear()}}},{key:"selectPolygonByDraw",value:function(e){this.manageSelectedClassInDropdown(e);var t="m-selectarea-button"===e.currentTarget.id?"Polygon":"LineString";if(this.deactiveControls(),e.currentTarget.offsetParent.previousElementSibling.className.indexOf("selected")<0){this.unselectControls(),e.currentTarget.offsetParent.previousElementSibling.className+=" selected";var o=this.onPolygonSelectedByDraw.bind(this);this.insertTemporalGeomControl.activate(o,t)}else this.showDropdownContent()}},{key:"onPolygonSelectedByDraw",value:function(e){for(var t=this.entityLayer_.getFeatures(),o=ut(t,this.impl_.getGeoJsonFromFeature(e.feature).geometry),n=0;n<o.length;n++){var r=null;if(t.forEach((function(e,t,i){o[n].getId()===e.getId()&&(r=o[n])})),null!==r){var i=null;this.entityLayer_.selectedFeatures_.forEach((function(e,t,r){o[n].getId()===e.getId()&&(i=o[n])})),null===i?this.entityLayer_.selectFeature(r):this.entityLayer_.unselectFeature(r)}}}},{key:"selectAllSandboxPolygon",value:function(){this.entityLayer_.getFeatures().length>0?(this.deactiveControls(),this.unselectControls(),this.entityLayer_.selectAllFeatures()):M.dialog.info(ot("dialog_noGeometry"))}},{key:"deselectAllSandboxPolygon",value:function(){this.entityLayer_.selectedFeatures_.length>0?(this.deactiveControls(),this.unselectControls(),this.entityLayer_.unselectAllFeatures()):M.dialog.info(ot("dialog_noGeometry_selected"))}},{key:"modifyPolygon",value:function(e){if(this.entityLayer_.selectedFeatures_.length>0)if(this.restoreDefaultClassDropdownButtons(),this.deactiveControls(),e.currentTarget.className.indexOf("selected")<0){this.unselectControls(),e.currentTarget.className+=" selected";for(var t=this.entityLayer_.selectedFeatures_,o=0;o<t.length;o++){var n=this.impl_.getModifyStyle(this.entityLayer_.getImplFeature(t[o]));this.entityLayer_.getImplFeature(t[o]).setStyle(n)}var r=this.onPolygonModified.bind(this);this.modifyGeomControl.activate(r),this.snappingControl.deactivate(),this.snappingButton.className.indexOf("selected")>0&&this.snappingControl.activate(null,null)}else this.unselectControls();else M.dialog.info(ot("dialog_noGeometry_selected"))}},{key:"onPolygonModified",value:function(e){for(var t=e.features.getArray(),o=0;o<t.length;o++)t[o].getRevision()>1&&t[o]}},{key:"dividePolygon",value:function(e){if(this.restoreDefaultClassDropdownButtons(),this.deactiveControls(),e.currentTarget.className.indexOf("selected")<0){this.unselectControls(),e.currentTarget.className+=" selected";var t=this.onPolygonDivided.bind(this);this.insertTemporalGeomControl.activate(t,"LineString"),document.body.style.cursor="pointer"}else this.unselectControls()}},{key:"onPolygonDivided",value:function(e){var t,o=this.entityLayer_.selectedFeatures_,n=[];if(o.length>0){var r=new M.Feature(Math.floor(1e6*Math.random()),this.impl_.getGeoJsonFromFeature(e.feature));t=ut(o,r.getGeometry());for(var i=0;i<t.length;i++)n.push(dt(r,t[i]));for(var a=!1,l=0;l<n.length;l++)0!==n[l]&&-1!==n[l]&&-2!==n[l]&&void 0!==n[l]&&null!==n[l]||(a=!0);if(a)M.dialog.info(ot("dialog_noValidGeometry"),ot("geometry_divide"));else{for(var s=0;s<n.length;s++)this.entityLayer_.addFeatures(n[s]);this.entityLayer_.removeFeaturesFromSandBox(t)}}else M.dialog.info(ot("dialog_atLeast_oneSelected"),ot("geometry_divide"))}},{key:"confirmDialogJoinPolygons",value:function(e){if(this.entityLayer_.selectedFeatures_.length>1){var t=this.joinPolygons.bind(this);nt(ot("dialog_union"),ot("dialog_union_title"),"info",t)}else M.dialog.info(ot("dialog_atLeast_twoSelected"),ot("dialog_union_title"))}},{key:"joinPolygons",value:function(){var e,t,o=this.entityLayer_.selectedFeatures_,n=[],r=[],i=[];this.restoreDefaultClassDropdownButtons(),rt();for(var a=0;a<o.length;a++){var l=new M.Feature(o[a].getId(),{type:"Feature",geometry:o[a].getGeometry(),geometry_name:"geometry",properties:{}});i.push(l)}if(o.length>0){this.deactiveControls(),this.unselectControls();for(var s=0;s<o.length;s++){e=o[s];for(var u=0;u<i.length;u++){n.push(e);var c=ft(e.getGeometry()),y=ft(i[u].getGeometry());if(!0===c.intersects(y)&&!1===e.equals(i[u])){r.push(this.entityLayer_.getImplFeature(e)),n.push(i[u]),(t=lt(n[0],n[1])).setId(Math.floor(1e6*Math.random())),n=[],this.entityLayer_.addNewMFeatureToSandBox(t),r.push(i[u]),this.entityLayer_.removeFeaturesFromSandBox(r);for(var f=0;f<r.length;f++){var d=i.indexOf(r[f]);d>-1&&i.splice(d,1)}var p=t.getGeoJSON();e=new M.Feature(t.getId(),p),u=0,s=0}else n=[]}}}else M.dialog.info(ot("dialog_atLeast_twoSelected"))}},{key:"intersectPolygon",value:function(e){if(this.restoreDefaultClassDropdownButtons(),0!==this.entityLayer_.selectedFeatures_.length)if(this.deactiveControls(),e.currentTarget.className.indexOf("selected")<0){this.unselectControls(),e.currentTarget.className+=" selected",document.body.style.cursor="pointer";var t=this.onPolygonIntersected.bind(this);this.selectGeomControl.activate(t),this.highlightControl.activate()}else this.highlightControl.deactivate(),this.unselectControls();else M.dialog.info(ot("dialog_removeFeatures_noGeometry"),ot("dialog_intersect_title"))}},{key:"onPolygonIntersected",value:function(e){var t,o;if((o=this.entityLayer_.selectedFeatures_).length>0&&(t=ut(o,this.entityLayer_.getMFeatureById(e.selected[0].getId()).getGeometry())).length>0){var n=[];n.push(t),n.push(this.entityLayer_.getMFeatureById(e.selected[0].getId())),this.doSpatialProcess(ct,n),this.clear()}}},{key:"emptyPolygon",value:function(e){if(this.restoreDefaultClassDropdownButtons(),0!==this.entityLayer_.selectedFeatures_.length)if(this.deactiveControls(),e.currentTarget.className.indexOf("selected")<0){this.unselectControls(),e.currentTarget.className+=" selected",document.body.style.cursor="pointer";var t=this.onGeometryEmptied.bind(this);this.selectGeomControl.activate(t),this.highlightControl.activate()}else this.highlightControl.deactivate(),this.unselectControls();else M.dialog.info(ot("dialog_removeFeatures_noGeometry"),ot("dialog_empty_title"))}},{key:"onGeometryEmptied",value:function(e){var t=this.entityLayer_.selectedFeatures_;if(t.length>0){var o=[];o.push(t),o.push(this.entityLayer_.getMFeatureById(e.selected[0].getId())),this.doSpatialProcess(yt,o),this.clear()}}},{key:"doSpatialProcess",value:function(e,t){for(var o=t[0],n=t[1],r=0;r<o.length;r++){var i=o[r];if(n!==i){var a=e.apply(this,[i,n]),l=new M.Feature(Math.floor(1e6*Math.random())+1,{type:"Feature",geometry:a,geometry_name:"geometry",properties:{}});if("MultiPolygon"===l.getGeometry().type){var s=this.impl_.createOLPolygonFeature(l);this.entityLayer_.addNewMFeatureToSandBox(s)}else this.entityLayer_.addNewMFeatureToSandBox(l)}(o.length>1||1===o.length&&n!==i)&&this.entityLayer_.removeFeaturesFromSandBox([i])}}},{key:"addGeom",value:function(e){var t=[];this.facadeMap_.getLayers().forEach((function(e){e instanceof M.layer.Vector&&"editionLayer"!=e.name&&e.getFeatures().length>0&&t.push(e)}));var o=this.addGeomFromVectorialLayer.bind(this);nt(ot("dialog_add_geometry"),ot("dialog_add_geometry_title"),"info",o,void 0,t)}},{key:"addGeomFromVectorialLayer",value:function(e){var t=this,o=this.facadeMap_.getLayers({name:e})[0];this.entityLayer_.removeAllFeatures();var n=o.getFeatures()[0].getGeometry().type;this.entityLayer_.setType(n),o.getFeatures().forEach((function(e){var o=e.getGeoJSON(),n=new M.Feature(e.getId(),o);t.entityLayer_.addNewMFeatureToSandBox(n)})),rt()}},{key:"checkWFSManagerPlugin",value:function(){var e=this.facadeMap_.getPanels("Catalog")[0].getControls()[0];if(e){for(var t=0;t<e.controls_.length;t++)"WFSManagerControl"===e.controls_[t].name&&(this.WFSManagerCtl=e.controls_[t]);return null!==this.WFSManagerCtl}return!1}},{key:"zoomToSandBox",value:function(e){this.manageSelectedClassInDropdown(e),this.entityLayer_.getFeatures().length>0?this.entityLayer_.zoomToFeatures(this.entityLayer_.getFeatures()):M.dialog.info(ot("dialog_noGeometry"),ot("dialog_zoom_title"))}},{key:"zoomToSelection",value:function(e){this.manageSelectedClassInDropdown(e),this.entityLayer_.selectedFeatures_.length>0?this.entityLayer_.zoomToFeatures(this.entityLayer_.selectedFeatures_):M.dialog.info(ot("dialog_removeFeatures_noGeometry"),ot("dialog_zoom_select"))}},{key:"getWfsFeatures",value:function(e){var t=this;e.preventDefault();var o=document.getElementsByClassName("m-mapea-container")[0];M.EditionSpinner.show(o);var n=this.WFSManagerCtl.getServiceActive(),r=this.impl_.getFeatureRequestBody(n,e.coordinate),i={jsonp:n.useProxy},a=(new XMLSerializer).serializeToString(r);M.proxy(n.useProxy),M.remote.post(n.url,a,i).then((function(e){if(M.proxy(!0),200===e.code)return Number(e.xml.documentElement.getAttribute("numberOfFeatures"))<1?(M.EditionSpinner.close(o),void M.dialog.info(ot("dialog_not_found")+n.description)):e.text;M.dialog.error(ot("dialog_cannot_consult"))})).then((function(e){var r=t.entityLayer_.readGML3Features(e);if(r.length>0){for(var i=0;i<r.length;i++)t.entityLayer_.addNewFeatureToSandBox(r[i]);M.EditionSpinner.close(o)}else M.EditionSpinner.close(o),M.dialog.info(ot("dialog_not_found")+n.description)})).catch((function(e){M.EditionSpinner.close(o),M.dialog.error(ot("dialog_cannot_consult"))}))}},{key:"deactiveControls",value:function(){this.insertGeomControl.deactivate(),this.insertTemporalGeomControl.deactivate(),this.modifyGeomControl.deactivate(),this.selectGeomControl.deactivate(),this.snappingControl.deactivate(),this.highlightControl.deactivate(),this.facadeMap_.getMapImpl().un("click",this.getWfsFeatures,this)}},{key:"unselectControls",value:function(){this.insertPolygonButton.className=this.insertPolygonButton.className.replace(" selected",""),this.addGeomButton.className=this.addGeomButton.className.replace(" selected",""),this.selectPolygonButton.className=this.selectPolygonButton.className.replace(" selected",""),this.selectPolygonByLineButton.className=this.selectPolygonByLineButton.className.replace(" selected",""),this.selectPolygonByAreaButton.className=this.selectPolygonByAreaButton.className.replace(" selected",""),this.modifyPolygonButton.className=this.modifyPolygonButton.className.replace(" selected",""),this.dividePolygonButton.className=this.dividePolygonButton.className.replace(" selected",""),this.intersectPolygonButton.className=this.intersectPolygonButton.className.replace(" selected",""),this.emptyPolygonButton.className=this.emptyPolygonButton.className.replace(" selected",""),this.removeFromSandBoxButton.className=this.removeFromSandBoxButton.className.replace(" selected","");for(var e=this.entityLayer_.selectedFeatures_,t=0;t<e.length;t++)e[t].getImpl().getOLFeature().setStyle(this.entityLayer_.getSelectedStyle());document.body.style.cursor="default"}},{key:"clear",value:function(){this.unselectControls(),this.deactiveControls()}},{key:"equals",value:function(e){var t=!1;return e instanceof M.control.EditionGeometryControl&&(t=this.name===e.name),t}},{key:"destroy",value:function(){this.getImpl().destroy()}}])&&_t(o.prototype,n),r&&_t(o,r),t}(Ye);function Ot(e){return(Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Lt(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function kt(e,t){return!t||"object"!==Ot(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xt(e,t,o){return(xt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Bt(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(o):r.value}})(e,t,o||e)}function Bt(e){return(Bt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Mt(e,t){return(Mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ct=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(N)&&M.exception("La implementación usada no puede crear controles editionControl");var o=new N;return(e=kt(this,Bt(t).call(this,o,"edition"))).sandBoxLayer_=null,e}var o,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mt(e,t)}(t,M.Control),o=t,(n=[{key:"createView",value:function(e){var t=this,o=this;return this.facadeMap_=e,new Promise((function(e,n){var i=M.template.compileSync(r.a,{vars:{translations:{import_btn:ot("import_btn"),select_btn:ot("select_btn"),select_click:ot("select_click"),select_line:ot("select_line"),select_area:ot("select_area"),select_all:ot("select_all"),deselect_all:ot("deselect_all"),zoom:ot("zoom"),zoom_sandbox:ot("zoom_sandbox"),zoom_selection:ot("zoom_selection"),geometry_draw:ot("geometry_draw"),snapping:ot("snapping"),modify_polygon:ot("modify_polygon"),geometry_divide:ot("geometry_divide"),union:ot("union"),empty_polygon:ot("empty_polygon"),intersection:ot("intersection"),delete_selected:ot("delete_selected")}}});o.element_=i,o.sandBoxLayer_=new c(t),o.createControls(),e(i)}))}},{key:"createControls",value:function(){this.highlightControl=new X(this.facadeMap_,this.sandBoxLayer_),this.insertGeomControl=new le(this.facadeMap_,this.sandBoxLayer_),this.modifyGeomControl=new be(this.facadeMap_,this.sandBoxLayer_),this.insertTemporalGeomControl=new Ce(this.facadeMap_,this.sandBoxLayer_),this.snappingControl=new Je(this.facadeMap_,this.sandBoxLayer_),this.selectGeomControl=new B(this.facadeMap_,this.sandBoxLayer_),this.geomControl=new Pt(this)}},{key:"activate",value:function(){xt(Bt(t.prototype),"activate",this).call(this)}},{key:"deactivate",value:function(){xt(Bt(t.prototype),"deactivate",this).call(this),this.getImpl().deactivateClick(this.map_)}},{key:"getActivationButton",value:function(e){return e.querySelector(".m-edition button")}},{key:"destroyControls",value:function(){this.geomControl.clear(),this.sandBoxLayer_.destroy()}},{key:"equals",value:function(e){return e instanceof t}}])&&Lt(o.prototype,n),i&&Lt(o,i),t}(),jt=o(4);function Et(e){return(Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function It(e,t){return!t||"object"!==Et(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Tt(e){return(Tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Gt(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Nt(e,t,o){return t&&Gt(e.prototype,t),o&&Gt(e,o),e}function zt(e,t){return(zt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Dt=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=It(this,Tt(t).call(this))).map_=null,e.controls_=[],e.position="TL",e.metadata_=jt.metadata,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zt(e,t)}(t,M.Plugin),Nt(t,null,[{key:"NAME",get:function(){return"edition"}}]),Nt(t,[{key:"addTo",value:function(e){this.control_=new Ct,this.controls_.push(this.control_),this.map_=e,this.panel_=new M.ui.Panel("paneledition",{collapsible:!0,className:"m-edition",collapsedButtonClass:"g-editiontools-closed",openedButtonClass:"g-editiontools-opened-vertical",position:M.ui.position[this.position],tooltip:ot("tooltip")}),this.panel_.addControls(this.controls_),e.addPanels(this.panel_)}},{key:"getMetadata",value:function(){return this.metadata_}},{key:"getAPIRest",value:function(){return"".concat(this.name,"=").concat(this.position)}},{key:"destroy",value:function(){this.control_.destroyControls(),this.map_.removeControls([this.control_]),this.map_=null,this.control_=null,this.panel_=null}},{key:"equals",value:function(e){return e instanceof t}},{key:"name",get:function(){return"edition"}}]),t}();window.M.plugin||(window.M.plugin={}),window.M.plugin.Edition=Dt}]);
//# sourceMappingURL=edition.ol.min.js.map